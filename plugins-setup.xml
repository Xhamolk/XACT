<project name="XACT Plugins" basedir="">

    <!-- Versions -->
    <property file="version.properties"/>
    <property name="forge.version" value="${mc.version}-${forge.version.mayor}.${forgebuild}"/>

    <!-- Directories -->
    <property file="build.properties"/>
    <condition property="custom.root">
        <and>
            <isset property="build.baseDir"/>
            <not>
                <equals arg1="${build.baseDir}" arg2=""/>
            </not>
        </and>
    </condition>

    <condition property="build.dir" value="${build.baseDir}/MC ${mc.version} #${forgebuild}"
               else="MC ${mc.version} #${forgebuild}">
        <istrue value="${custom.root}"/>
    </condition>
    <property name="forge.dir" value="${build.dir}/forge"/>
    <property name="download.dir" value="${build.dir}/downloads"/>
    <property name="mcp.dir" value="${forge.dir}/mcp"/>
    <property name="mcpsrc.dir" value="${mcp.dir}/src/minecraft"/>
    <condition property="api.src.dir" value="${mcpsrc.dir}" else="${build.dir}/Mod APIs">
        <istrue value="${copy.xact.srcs}"/>
    </condition>


    <!-- URLs -->
    <property name="forge.url"
              value="http://files.minecraftforge.net/minecraftforge/minecraftforge-src-${forge.version}.zip"/>
    <property name="ue.download.dir" value="${download.dir}/ue/minecraft/universalelectricity"/>

    <property name="invtweaks.url"
              value="https://github.com/Kobata/inventory-tweaks/archive/${invtweaks.version}.zip"/>


    <!-- Main Targets -->
    <mkdir dir="${download.dir}"/>
    <mkdir dir="${api.src.dir}"/>

    <target name="download-all" depends="download-apis, download-nei, download-mps"/>

    <target name="copy-access-transformers" depends="copy-nei-access-transformers"/>

    <target name="copy-sources" depends="copy-nei-sources, copy-mps-sources">

        <echo message="Extracting Inventory Tweaks API... "/>
        <unzip src="${download.dir}/InventoryTweaks-api-${invtweaks.version}.zip" dest="${download.dir}"/>
        <mkdir dir="${api.src.dir}/invtweaks/api"/>
        <move file="${download.dir}/inventory-tweaks-${invtweaks.version}/src/minecraft/invtweaks/api/ContainerGUI.java"
              todir="${api.src.dir}/invtweaks/api"/>
        <move file="${download.dir}/inventory-tweaks-${invtweaks.version}/src/minecraft/invtweaks/api/ContainerSection.java"
              todir="${api.src.dir}/invtweaks/api"/>
    </target>


    <!-- APIs -->

    <target name="download-apis">
        <echo message="Downloading Inventory Tweaks API... "/>
        <get src="${invtweaks.url}"
             dest="${download.dir}/InventoryTweaks-api-${invtweaks.version}.zip"/>
    </target>


    <!-- Modular Powersuits -->

    <target name="download-mps" if="build.plugin.mps">
        <get src="https://github.com/MachineMuse/MachineMusePowersuits/archive/master.zip"
             dest="${download.dir}/mps.zip"/>
    </target>

    <target name="copy-mps-sources" if="build.plugin.mps">
        <unzip src="${download.dir}/mps.zip" dest="${download.dir}"/>

        <copy todir="${api.src.dir}">
            <fileset dir="${download.dir}/MachineMusePowersuits-master/src/minecraft">
                <include name="net/machinemuse/api/IModularItem.java"/>
                <include name="net/machinemuse/api/IPowerModule.java"/>
                <include name="net/machinemuse/api/IPropertyModifier.java"/>
                <include name="net/machinemuse/api/moduletrigger/IRightClickModule.java"/>
            </fileset>
        </copy>
    </target>


    <!-- NEI -->

    <target name="copy-nei-access-transformers" if="build.plugin.nei">
        <mkdir dir="${forge.dir}/accesstransformers"/>
        <copy todir="${forge.dir}/accesstransformers" file="${download.dir}/NEI/nei_at.cfg"/>
        <copy todir="${forge.dir}/accesstransformers" file="${download.dir}/CCC/codechickencore_at.cfg"/>
    </target>

    <target name="copy-nei-sources" if="build.plugin.nei">
        <copy todir="${mcp.dir}/src/minecraft" overwrite="true">
            <fileset dir="${download.dir}/NEI">
                <include name="codechicken/**/*.*"/>
                <include name="net/**/*.*"/>
            </fileset>
            <fileset dir="${download.dir}/CCC">
                <include name="codechicken/**/*.*"/>
                <include name="net/**/*.*"/>
            </fileset>
        </copy>
    </target>

    <condition property="nei-downloaded">
        <and>
            <available file="${download.dir}/CCC-src.jar"/>
            <available file="${download.dir}/NEI-src.jar"/>
        </and>
    </condition>

    <target name="download-nei" unless="nei-downloaded" if="build.plugin.nei">
        <mkdir dir="${download.dir}"/>
        <echo message="Downloading NEI and CCC"/>

        <get src="http://www.chickenbones.craftsaddle.org/Files/New_Versions/1.5.1/CodeChickenCore-src.jar"
             dest="${download.dir}/CCC-src.jar"/>
        <get src="http://www.chickenbones.craftsaddle.org/Files/New_Versions/1.5.1/NotEnoughItems-src.jar"
             dest="${download.dir}/NEI-src.jar"/>

        <!-- Extract NEI and CCC -->
        <unzip src="${download.dir}/NEI-src.jar" dest="${download.dir}/NEI"/>
        <unzip src="${download.dir}/CCC-src.jar" dest="${download.dir}/CCC"/>
    </target>



</project>